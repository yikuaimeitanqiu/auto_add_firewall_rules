# auto_add_firewall_rules
防火墙规则自动添加


## 使用说明

- 通过添加富规则策略实现对系统进行防护。

- 此脚本适用于使用 `firewalld` 服务管理 防火墙的系统。
    - `systemctl` 默认已为现在发行版本的服务管理
    - `iptables` 后续考虑适配

- 脚本目录结构：
    ```shell
    ├── backup          #删除防火墙策略时用于存放临时文件
    ├── conf            #存放脚本目录
    ├── bin             #防火墙脚本
    ├── lib             #检测入参配置脚本
    ├── modules         #存放模块目录
    ├── install.sh      #主脚本
    └── log             #执行脚本日志生成目录
    ```

- 运行方法：
    ```shell
    tar -xvf auto_add_firewall_rules.tar.gz
    cd ./auto_add_firewall_rules
    ./install.sh
    ```


- 菜单说明：
    ```shell
    请选择:
    1. 自动添加 *默认* 相关防火墙策略
    2. 自动删除 *默认* 相关防火墙策略
    3. 手动添加防火墙策略(慎重)
    4. 手动删除防火墙策略(慎重)
    5. 查看已生效的防火墙策略
    6. 手动启动防火墙服务
    7. 手动停止防火墙服务
    8. 已完成确认，确认退出.(请勿强制退出)
    ```

- 通过输入数字执行对应脚本功能。请正确输入数字，并按提示操作。

- 自动添加删除策略，只针对 `conf` 目录下，文件自动加载添加删除策略。
    - `./install.sh add` 自动添加 `conf` 目录下的自定义规则
    - `./install.sh del` 自动删除 `conf` 目录下的自定义规则

- 退出脚本请一定要输入数字：8 ，否则会影响防火墙服务运行状态。
    - 8 为清理保险设置并同时退出脚本。


- 添加防火墙策略流程：
    - `3-->5-->8`
        - 输入3，添加自定义防火墙时，建议开启保险，15分钟后自动停止防火墙服务，防止错误策略在生产环境中被阻挡在墙外。（某些生产环境中需要限制SSH地址访问，如对策略了解可以不启用保险。）
        - 端口号、协议类型、处理规则  三个为必填，根据提示并结合自身实际需求，完成策略添加。
        - 输入5，查看刚添加的策略是否已生效。
        - 输入8，退出并清理定时关闭防火墙脚本。


- 删除防火墙策略流程：
    - `4-->5-->8`
        - 输入4，查看所有已生效的富规则策略，对需要删除的策略，输入行首的数字编号，确认即可删除。建议开启保险，15分钟后自动停止防火墙服务，防止错误策略在生产环境中被阻挡在墙外。（某些生产环境中需要限制SSH地址访问，如对策略了解可以不启用保险。）
        - 输入5，查看刚删除的策略是否已生效。
        - 输入8，退出并清理定时关闭防火墙脚本。

- 6/7 手动启动防火墙服务


